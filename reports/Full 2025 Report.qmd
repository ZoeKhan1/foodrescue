---
title: "Spring and Fall 2025 Report"
author: "Anabel Fletcher, Zoe Khan, Julia Twomey"
date: "December 14, 2025"
format: pdf
editor: visual
output:
  html_document:
    toc: no
    df_print: paged
header-includes:
  - \usepackage{caption}
  - \usepackage{subcaption}
---

```{r}
#| eval: true
#| include: false

# Set outputs for rendering
knitr::opts_chunk$set(
  echo = FALSE, message = FALSE, warning = FALSE
)

# DO NOT CHANGE
```

```{r}
# WHAT YOU NEED TO CHANGE
start_date_spring <- '1-1-2025'
end_date_spring <- '7-11-2025'

start_date_fall <- '9-20-2025'
end_date_fall <- '12-12-2025'
```

```{r}
# Housekeeping
# Load libraries 
library(foodrescue)
library(dplyr)
library(kableExtra)
library(ggplot2)
library(lubridate)
library(patchwork)

# Load data
data(raw_food)

# Clean data
df <- clean_food2(raw_food)
clean_data <- df[['clean_data']]
tidy_data <- df[['tidy_data']]

# All dining halls
dining_halls <- c("Campus Center Cafe", "Chase Duckett", "Compass Cafe", "Comstock", "King Scales", "Lamont", "Northrop Gillett", "Tyler", "Catering", "Cutter Ziskind")
```

# Introduction

The Food Rescue Network saw substantial growth in 2025 thanks to the efforts of our volunteers, Manna associates, and dining hall staff. This year, we went from rescuing 340+ containers of food over the course of 150 pickups in the Spring to rescuing 514+ containers of food over the course of 182 pickups in the Fall. Thank you to everyone who made this possible!

In total, 2925 lbs of food were rescued in the Spring and 4085 lbs of food were rescued in the Fall, a 40% increase from Spring semester.

### Summary statistics

```{r tbl-weekly-stats-spring}
library(kableExtra)
weekly_stats(clean_data, tidy_data, start_date_spring, end_date_spring, dining_halls) |> 
  kable(col.names = c("Weight (lbs)", "Containers", "Pick-ups"), caption = "Summary Statistics Spring 2025") |>
  row_spec(0, background = "#48D1CC", color = "black")
```

```{r tbl-weekly-stats-fall}
weekly_stats(clean_data, tidy_data, start_date_fall, end_date_fall, dining_halls) |> 
  kable(col.names = c("Weight (lbs)", "Containers", "Pick-ups"), caption = "Summary Statistics Fall 2025") |>
  row_spec(0, background = "#48D1CC", color = "black")

```

# Table Summaries

### Recovery by food type

One of the top recovered food in both semesters was chicken, with 451lbs in the Spring and 1001lbs in the Fall. The other was mixed, meaning that it doesn't fit cleanly into one of our set categories. The 3rd most recovered food in the Spring was rice at 372lbs, ranking 4th in the Fall at 472lbs. Other food types high up in the rankings in both semesters include vegetables, beans, and beef.

```{r tbl-type-spring}
recovery_tables(tidy_data, start_date_spring, end_date_spring, dining_halls, "type") |>
  kable(col.names = c("Type", "Weight (lbs)"), caption = "Recovery by food type Spring 2025")|>
  row_spec(0, background = "#48D1CC", color = "black")
```

```{r tbl-type-fall}
recovery_tables(tidy_data, start_date_fall, end_date_fall, dining_halls, "type") |>
  kable(col.names = c("Type", "Weight (lbs)"), caption = "Recovery by food type Fall 2025")|>
  row_spec(0, background = "#48D1CC", color = "black")
```

### Recovery by dining hall

The top four dining halls remained mostly the same over the two semesters, though the order shifted. In the Spring, Northrop Gillett was the dining hall with the highest recovery, weighing in at 761.4 lbs. In the Fall, Tyler took place over other dining halls with a total of 901.9 lbs rescued. With the exception of Northrop Gillett, Comstock, the Compass cafe, and the Campus Center Cafe, all other dining halls saw an increase in recovered food in the Fall semester.

One notable difference accounting for some of the variation between Spring and Fall is that Food Rescue only began recovering food from Lamont in the Fall, which was absent from Spring data.

```{r tbl-hall-spring}
recovery_tables(tidy_data, start_date_spring, end_date_spring, dining_halls, "hall")|>
  kable(col.names = c("Dining Hall", "Weight (lbs)"),
        caption = "Recovery by food type Spring 2025")|>
  row_spec(0, background = "#48D1CC", color = "black")
```

```{r tbl-hall-fall}
recovery_tables(tidy_data, start_date_fall, end_date_fall, dining_halls, "hall")|>
  kable(col.names = c("Dining Hall", "Weight (lbs)"),
        caption = "Recovery by food type Fall 2025")|>
  row_spec(0, background = "#48D1CC", color = "black")
```

### Top 25 recovered foods (by dining hall and type)

In the Spring and the Fall, the top recovered item was mixed from the Compass Cafe (388lbs in the Spring, 359.2 in the Fall). Chicken recovery made up for 3 out of the top ten top recovered items in the Fall, and meat in general made up 5 out of the top ten.

```{r tbl-top-spring}
recovery_tables(tidy_data, start_date_spring, end_date_spring, dining_halls, "top") |>
  kable(col.names = c("Dining hall", "Type", "Weight (lbs)"),
        caption = "Top foods Spring 2025") |>
  row_spec(0, background = "#48D1CC", color = "black")
```

```{r tbl-top-fall}
recovery_tables(tidy_data, start_date_fall, end_date_fall, dining_halls, "top")|>
  kable(col.names = c("Dining hall", "Type", "Weight (lbs)"),
        caption = "Top foods Fall 2025") |>
  row_spec(0, background = "#48D1CC", color = "black")
```

# Recovery Distributions

Below are visualizations of the recovery distributions by dining hall (first two graphs) and then a breakdown of recovery distributions by food type for each dining hall each semester.

Note that any empty graphs reflect zero food recovered from a given dining hall. If the Campus Center Recovery Distribution graph looks confusing, that is due to all food recovered from the Campus Center falling into the “mixed” category.

```{r}
plot_recovery(tidy_data, start_date_spring, end_date_spring, dining_halls) +
  labs(title = "Recovery by dining hall Spring 2025")
```

```{r}
plot_recovery(tidy_data, start_date_fall, end_date_fall, dining_halls) +
  labs(title = "Recovery by dining hall Fall 2025")
```

```{r}
# for (i in dining_halls) {
#   print(plot_recovery(tidy_data, start_date_spring, end_date_spring, i) + 
#     labs(title = paste0(i, " Recovery Distribution")) +
#     theme(axis.text.x = element_text(angle = 45, hjust = 1)))
#   
# }
```

```{r}
# for (i in dining_halls) {
#   print(plot_recovery(tidy_data, start_date_fall, end_date_fall, i) + 
#     labs(title = paste0(i, " Recovery Distribution")) +
#     theme(axis.text.x = element_text(angle = 45, hjust = 1)))
#   
# }
```

```{r}
# Initialize start and end dates
starts <- mdy(c('1-1-2025', '9-1-2025'))
ends <- mdy(c('7-11-2025', '12-12-2025'))
semester <- c("Spring", "Fall")
tidy_data <- tidy_data |>
  mutate(semester = case_when(
    date >= mdy("1-1-2025") & date <= mdy("7-11-2025") ~ "Spring",
    date >= mdy("9-1-2025") & date <= mdy("12-12-2025") ~ "Fall",
    TRUE ~ NA
  ))

# Looping through each dining hall each semester and printing patchwork graphs
for (hall in dining_halls) {
  
  z <- tidy_data |>
    filter(date >= starts[1]) |>
    filter(date <= ends[2]) |>
    filter(dining_hall == hall) |>
    filter(!is.na(.data$weight)) |>
    group_by(type, semester) |>
    summarize(sum = sum(weight))
  ymax <- max(z$sum, na.rm = TRUE)  # Ensures y-axis is static across semesters
  
  plots <- vector("list", length(starts))  # Initializing list for the two plots in each row
  
  for (i in seq_along(starts)) {
    hall_data <- tidy_data |>
      filter(date >= starts[i]) |>
      filter(date <= ends[i]) |>
      filter(dining_hall == hall) |>
      filter(!is.na(.data$weight))  # Subsetting data

    plots[[i]] <- ggplot(hall_data, aes(x = type, y = weight)) +
      geom_col() +
      scale_y_continuous(limits = c(0, ymax)) +
      labs(title = paste0(hall, " ", semester[i], " 2025"), y = "Weight (lbs)", x = "Type") +
      theme_bw() +
      theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Creating graph
      
  }
  combined <- wrap_plots(plots, ncol = length(plots)) # Patchwork combinationss
  print(combined)
}

```

# Limitations

This data and analysis is purely observational and may not capture all nuances about food waste and recovery at Smith. For example, in Spring 2025 our organization was not operating at full capacity due to limited availability of driver volunteers. The decrease in total recovery from that semester thus is influenced not only by dining policy and menu decisions, but by details of our own operations.

When we list Comstock as a dining hall, we assume that any food from Haynes is included.

We noticed there may be some bias regarding pick-ups from the Campus Center Cafe vs. Compass, with volunteers potentially mixing these two locations up when filling out the data form. We have not changed their answers post-hoc, so please be aware that these numbers are approximate.

Additionally, our code is programmed to automatically subtract two pounds from our volunteer inputs to account for the weight of a standard clear container. There is a risk of overestimation when volunteers weigh multiple containers simultaneously, as the code only anticipates one container. Similarly, dining halls occasionally donate food in lighter, disposable containers which would result in records being underestimated. Finally, records of lighter foods such as bread may be lost in the data when container weight is subtracted. Although it is unrealistic to capture perfectly accurate data, we can mitigate some of these errors by encouraging caution among volunteers when weighing in bulk and when weighing lighter containers.
