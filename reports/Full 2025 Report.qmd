---
title: "Spring 2025 Report"
author: "Your Name Here"
date: "October 9, 2025"
format: pdf
editor: visual
output:
  html_document:
    toc: no
    df_print: paged
header-includes:
  - \usepackage{caption}
  - \usepackage{subcaption}
---

```{r}
#| eval: true
#| include: false

# Set outputs for rendering
knitr::opts_chunk$set(
  echo = FALSE, message = FALSE, warning = FALSE
)

# DO NOT CHANGE
```

```{r}
# WHAT YOU NEED TO CHANGE
start_date_spring <- '1-1-2025'
end_date_spring <- '7-11-2025'

start_date_fall <- '9-20-2025'
end_date_fall <- '12-12-2025'
```

```{r}
# Housekeeping
# Load libraries 
library(foodrescue)
library(dplyr)
library(kableExtra)
library(ggplot2)
library(lubridate)
library(patchwork)

# Load data
data(raw_food)

# Clean data
df <- clean_food2(raw_food)
clean_data <- df[['clean_data']]
tidy_data <- df[['tidy_data']]

# All dining halls
dining_halls <- c("Campus Center Cafe", "Chase Duckett", "Compass", "Comstock", "Haynes", "King Scales", "Lamont", "Northrop Gillett", "Tyler", "Other", "Catering", "Cutter Ziskind")
```

# Introduction

Write your introduction here.

### Summary statistics

#### Spring 2025

```{r}
library(kableExtra)
weekly_stats(clean_data, tidy_data, start_date_spring, end_date_spring, dining_halls) |> row_spec(0, background = "#48D1CC", color = "black")
```

#### Fall 2025
```{r}
weekly_stats(clean_data, tidy_data, start_date_fall, end_date_fall, dining_halls) |> row_spec(0, background = "#48D1CC", color = "black")

```

# Table Summaries

### Total Food Recovered

Written analysis goes here.

#### Spring 2025
```{r}
recovery_tables(tidy_data, start_date_spring, end_date_spring, dining_halls, "total")
```

#### Fall 2025
```{r}
recovery_tables(tidy_data, start_date_fall, end_date_fall, dining_halls, "total")
```

### Recovery by food type

Written analysis goes here.

#### Spring 2025
```{r}
recovery_tables(tidy_data, start_date_spring, end_date_spring, dining_halls, "type")
```

#### Fall 2025
```{r}
recovery_tables(tidy_data, start_date_fall, end_date_fall, dining_halls, "type")
```

### Recovery by dining hall

Written analysis goes here.

#### Spring 2025
```{r}
recovery_tables(tidy_data, start_date_spring, end_date_spring, dining_halls, "hall")
```

#### Fall 2025
```{r}
recovery_tables(tidy_data, start_date_fall, end_date_fall, dining_halls, "hall")
```

### Top 25 recovered foods (by dining hall and type)

Written analysis goes here.

#### Spring 2025
```{r}
recovery_tables(tidy_data, start_date_spring, end_date_spring, dining_halls, "top")
```

#### Fall 2025
```{r}
recovery_tables(tidy_data, start_date_fall, end_date_fall, dining_halls, "top")
```

# Recovery Distributions

Discuss recovery distributions here.

```{r}
plot_recovery(tidy_data, start_date_spring, end_date_spring, dining_halls, fill = TRUE)
```

```{r}
plot_recovery(tidy_data, start_date_fall, end_date_fall, dining_halls, fill = TRUE)
```

```{r}
# for (i in dining_halls) {
#   print(plot_recovery(tidy_data, start_date_spring, end_date_spring, i) + 
#     labs(title = paste0(i, " Recovery Distribution")) +
#     theme(axis.text.x = element_text(angle = 45, hjust = 1)))
#   
# }
```

```{r}
# for (i in dining_halls) {
#   print(plot_recovery(tidy_data, start_date_fall, end_date_fall, i) + 
#     labs(title = paste0(i, " Recovery Distribution")) +
#     theme(axis.text.x = element_text(angle = 45, hjust = 1)))
#   
# }
```

```{r}
# Initialize start and end dates
starts <- mdy(c('1-1-2025', '9-1-2025'))
ends <- mdy(c('7-11-2025', '12-12-2025'))
semester <- c("Spring", "Fall")
tidy_data <- tidy_data |>
  mutate(semester = case_when(
    date >= mdy("1-1-2025") & date <= mdy("7-11-2025") ~ "Spring",
    date >= mdy("9-1-2025") & date <= mdy("12-12-2025") ~ "Fall",
    TRUE ~ NA
  ))

# Looping through each dining hall each semester and printing patchwork graphs
for (hall in dining_halls) {
  
  z <- tidy_data |>
    filter(date >= starts[1]) |>
    filter(date <= ends[2]) |>
    filter(dining_hall == hall) |>
    filter(!is.na(.data$weight)) |>
    group_by(type, semester) |>
    summarize(sum = sum(weight))
  ymax <- max(z$sum, na.rm = TRUE)  # Ensures y-axis is static across semesters
  
  plots <- vector("list", length(starts))  # Initializing list for the two plots in each row
  
  for (i in seq_along(starts)) {
    hall_data <- tidy_data |>
      filter(date >= starts[i]) |>
      filter(date <= ends[i]) |>
      filter(dining_hall == hall) |>
      filter(!is.na(.data$weight))  # Subsetting data

    plots[[i]] <- ggplot(hall_data, aes(x = type, y = weight)) +
      geom_col() +
      scale_y_continuous(limits = c(0, ymax)) +
      labs(title = paste0(hall, " ", semester[i])) +
      theme_bw() +
      theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Creating graph
      
  }
  combined <- wrap_plots(plots, ncol = length(plots)) # Patchwork combinationss
  print(combined)
}

```

# Limitations

Discuss limitations of this analysis here.
